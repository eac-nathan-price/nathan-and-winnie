<!-- <mat-form-field>
  <mat-label>Select Game</mat-label>
  <mat-select [(value)]="game">
    @for (game of games; track game) {
      <mat-option [value]="game">
        {{ game.title }}
      </mat-option>
    }
  </mat-select>
</mat-form-field>

@if (game) {
  <mat-form-field>
    <mat-label>Select Round</mat-label>
    <mat-select [(value)]="selectedRound">
      @for (round of game.rounds; track round; let i = $index) {
        <mat-option [value]="round">
          Round {{i + 1}}
        </mat-option>
      }
    </mat-select>
  </mat-form-field>

  @if (selectedRound) {
    <mat-form-field>
      <mat-label>Select Question</mat-label>
      <mat-select [(value)]="selectedQuestion">
        @for (question of selectedRound.questions; track question) {
          <mat-option [value]="question">
            {{ question.text }}
          </mat-option>
        }
      </mat-select>
    </mat-form-field>

    @if (selectedQuestion) {
      <div class="answers-grid" [style.grid-template-rows]="'repeat(' + gridRows + ', auto)'">
        @for (answer of selectedQuestion.answers; track answer) {
          <div class="answer-item">
            <span>{{ answer.text }} ({{ answer.points * selectedRound.multiplier }})</span>
          </div>
        }
      </div>
    }
  }
}

<form [formGroup]="teamsForm">
  <div formArrayName="teams">
    <div *ngFor="let team of teams.controls; let i=index" [formGroupName]="i" class="team-row">
      <mat-form-field>
        <input matInput formControlName="name" placeholder="Team Name">
      </mat-form-field>
      
      <mat-form-field>
        <input matInput type="number" formControlName="score" placeholder="Score">
      </mat-form-field>
      
      <button mat-icon-button (click)="removeTeam(i)">
        <mat-icon>close</mat-icon>
      </button>
    </div>
  </div>
  
  <button mat-button (click)="addTeam()">
    <mat-icon>add</mat-icon>
    Add Team
  </button>
</form> -->
@let game_ = currGame();
@if (!game_) {
  <div class="games">
    <h3>Games:</h3>
    @for (game of games; track game) {
      <ul>
        <li>
          <a [routerLink]="['/feud', { id: game.id }]">{{ game.title }}</a>
        </li>
      </ul>
    }
  </div>
} @else {
  @if (game_.password && password !== game_.password) {
    <div class="password">
      <mat-form-field appearance="outline">
        <input matInput [(ngModel)]="password" placeholder="Password">
      </mat-form-field>
    </div>
  } @else {
    <div class="form-row">
      <button mat-flat-button (click)="reopenWindow()">
        <mat-icon>open_in_new</mat-icon>
        <span>Reopen Window</span>
      </button>
      <audio controls>
        <source src="https://ia600907.us.archive.org/0/items/tvtunes_33032/Family%20Feud%20-%20Harvey%20Era.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
      </audio>
      <button mat-fab class="no" (click)="no(1)">
        <mat-icon class="large">disabled_by_default</mat-icon>
      </button>
      <button mat-fab class="no" (click)="no(2)">
        <mat-icon class="medium">disabled_by_default</mat-icon>
        <mat-icon class="medium">disabled_by_default</mat-icon>
      </button>
      <button mat-fab class="no" (click)="no(3)">
        <mat-icon>disabled_by_default</mat-icon>
        <mat-icon>disabled_by_default</mat-icon>
        <mat-icon>disabled_by_default</mat-icon>
      </button>
      <button mat-flat-button (click)="end()">
        <mat-icon>music_note</mat-icon>
        <span>End</span>
      </button>
    </div>
    <div class="form-row">
      @for (team of teams; track team; let i = $index) {
        <mat-form-field appearance="outline" subscriptSizing="dynamic">
          <input matInput [(ngModel)]="team.name" placeholder="Team {{i + 1}}">
        </mat-form-field>
        <mat-form-field appearance="outline" subscriptSizing="dynamic">
          <input type="number" matInput [(ngModel)]="team.score" placeholder="Score">
        </mat-form-field>
      }
    </div>

    <ng-template #template>
      <mat-tab-group mat-stretch-tabs="false" mat-align-tabs="center" [selectedIndex]="tabIndex" (selectedTabChange)="deactivate($event)">
        <mat-tab label="Title">
          <div class="tab cone">
            <div class="title">
              <div class="title-row">
                @for (text of game_.title1; track text) {
                  <span [attr.data-text]="text">{{ text }}</span>
                }
              </div>
              <div class="title-row">
                @for (text of game_.title2; track text) {
                  <span [attr.data-text]="text">{{ text }}</span>
                }
              </div>
            </div>
            <div class="subtitle">
              <span>
                @for (text of game_.subtitle; track text) {
                  {{ text }}
                }
              </span>
            </div>
            <div class="teams">
              @for (team of teams; track team) {
                <div class="team-row">
                  <div class="team">{{ team.name }}</div>
                  <div class="points">{{ team.score }}</div>
                </div>
              }
            </div>
          </div>
        </mat-tab>
  
        @for (round of game_.rounds; track round;) {
          <mat-tab [label]="round.title">
            @if (!activeQuestion) {
              <div class="tab colors">
                @if (round.type === 'tossup') {
                  <h1>{{ round.title }} - {{ round.multiplier }}x Points</h1>
                } @else if (round.type === 'tiebreak') {
                  <h1>{{ round.title }} - Highest Score Wins</h1>
                } @else if (round.type === 'rapid') {
                  <h1>{{ round.title }}</h1>
                }
                @for (question of round.questions; track question) {
                  <div class="question" [ngClass]="{'internal-only': round.type === 'rapid'}">
                    <h2>{{ question.text }}</h2>
                    @if (round.type === 'tossup') {
                      @for (team of teams; track team) {
                        <button mat-flat-button class="internal-only" (click)="activate(round, question, team)">{{ team.name }}</button>
                      }
                    } @else if (round.type === 'tiebreak') {
                      <button mat-flat-button class="internal-only">Tiebreak</button>
                    }
                  </div>
                }
              </div>
            } @else {
              <div class="tab">
                <div class="form-row internal-only">
                  <button mat-flat-button (click)="deactivate()">
                    <mat-icon>arrow_back</mat-icon>
                    <span>Back</span>
                  </button>
                  @for (team of teams; track team) {
                    <button mat-flat-button (click)="award(team)"> Award {{ team.name }}</button>
                  }
                </div>
                <h2>{{ activeQuestion.text }}</h2>
                <h3>{{ activePot }}</h3>
                <div class="answers">
                  @for (answer of activeQuestion.answers; track answer; let i = $index) {
                    <button class="answer" [ngClass]="{'internal-only': !activeAnswers[i]}" (click)="toggleAnswer(i)">
                      @if (!activeAnswers[i]) {
                        <span class="internal-only warn">(closed)</span>
                      }
                      <span>{{ answer.text }}</span>
                      <span>&nbsp;&mdash;&nbsp;</span>
                      <span>{{ answer.points * round.multiplier }}</span>
                    </button>
                    @if (!activeAnswers[i]) {
                      <div class="answer external-only">
                        <span>{{ i + 1 }}</span>
                      </div>
                    }
                  }
                </div>
              </div>
            }
          </mat-tab>
        }
      </mat-tab-group>
      <div class="overlay">
        @if (nos() > 0) {
          <mat-icon>disabled_by_default</mat-icon>
        }
        @if (nos() > 1) {
          <mat-icon>disabled_by_default</mat-icon>
        }
        @if (nos() > 2) {
          <mat-icon>disabled_by_default</mat-icon>
        }
      </div>
    </ng-template>
    <lib-window [windowTitle]="game_.title" [mirror]="true" [template]="template" [popup]="false" class="internal"></lib-window>
  }
}
